# Build from the same version of ubuntu as phusion/baseimage
FROM @@image@@

RUN apt-get update -y && \
    apt-get install -y ruby2.5 \
                       ruby2.5-dev \
                       zlib1g-dev \
                       liblzma-dev

ENV BUNDLER_VERSION 2.1.4
RUN gem install --no-rdoc --no-ri bundler:$BUNDLER_VERSION fpm

RUN mkdir -p /src/opt/conjur/project

WORKDIR /src/opt/conjur/project

COPY Gemfile ./
COPY Gemfile.lock ./

RUN bundle config set deployment 'true' && \
    bundle config set path 'vendor/bundle' && \
    bundle

COPY . .
ADD debify.sh /

WORKDIR /src
